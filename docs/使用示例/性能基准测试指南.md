# 性能基准测试指南

## 目标

- 使用内置基准套件评估写入、查询、属性索引、图算法性能
- 记录指标以追踪版本迭代影响

## 基准命令

```bash
pnpm benchmark             # 全量基准
pnpm benchmark:core        # 核心操作
pnpm benchmark:search      # 查询与属性索引
pnpm benchmark:graph       # 图算法
pnpm benchmark:spatial     # 空间索引
pnpm benchmark:memory      # 内存泄漏测试
```

## 结果位置

- CLI 输出：TPS、延迟、页分布、耗时
- 日志：`benchmarks/results/*.json`
- 可通过 `jq` 或 BI 工具分析

## 自定义基准

```ts
import { runBenchmark } from '@/benchmark/runner';

await runBenchmark({
  suites: ['insert_scan', 'path_agg'],
  output: 'custom-report.json',
});
```

## 分析指标

| 指标        | 说明                     |
| ----------- | ------------------------ |
| TPS         | 每秒事务数，衡量写入能力 |
| P95 Latency | 95% 延迟，评估稳定性     |
| WAL Bytes   | WAL 大小变化             |
| GC Count    | GC 次数，反映治理频率    |
| Memory Peak | 最高内存使用量           |

## 建议流程

1. 在一致的硬件/配置下运行基准
2. 记录基线结果
3. 每次 PR 或版本升级后重新运行，对比差异
4. 若变化超 10%，分析日志与 commit

## 延伸阅读

- [docs/教学文档/教程-05-索引选择与性能.md](../教学文档/教程-05-索引选择与性能.md)
- [docs/教学文档/教程-08-部署与最佳实践.md](../教学文档/教程-08-部署与最佳实践.md)
