# 08 · 图谱导出与可视化（Cytoscape JSON）

```ts
import { SynapseDB } from 'synapsedb';
import { writeFile } from 'node:fs/promises';

const db = await SynapseDB.open('graph.synapsedb');

const seed = 'method:User#login';
const steps = 2;

const nodes = new Map<number, { data: { id: string; label: string } }>();
const edges: Array<{ data: { id: string; source: string; target: string; label: string } }> = [];

function ensureNode(id: number, label: string) {
  if (!nodes.has(id)) nodes.set(id, { data: { id: String(id), label } });
}

function addEdge(s: number, pLabel: string, o: number) {
  edges.push({
    data: { id: `${s}-${pLabel}-${o}`, source: String(s), target: String(o), label: pLabel },
  });
}

let frontier = db.find({ subject: seed }).all();
for (let i = 0; i < steps; i += 1) {
  const next: typeof frontier = [] as any;
  for (const r of frontier) {
    const fwd = db.find({ subject: r.object }).all();
    for (const x of fwd) {
      ensureNode(r.subjectId, r.subject);
      ensureNode(x.objectId, x.object);
      addEdge(r.subjectId, r.predicate, x.objectId);
      (next as any).push(x);
    }
  }
  frontier = next as any;
}

const cy = { elements: { nodes: [...nodes.values()], edges } };
await writeFile('graph-cyto.json', JSON.stringify(cy, null, 2), 'utf8');
await db.close();
```

- 生成的 `graph-cyto.json` 可直接被 Cytoscape.js/很多在线演示加载
