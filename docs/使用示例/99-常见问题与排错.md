# 99 · 常见问题与排错

## ESM 导入失败 / ERR_MODULE_NOT_FOUND

- 你的项目需为 ESM（package.json: { "type": "module" }），或使用 tsx/ts-node ESM 运行器

## 全局装了 CLI，项目里 import 不到

- 全局安装只提供 CLI，作为库使用需将包安装到项目依赖（tgz/私有源）或使用 `npm link`

## 覆盖率阈值不通过

- 本仓库已限定覆盖率统计范围为 `src/**/*.ts`；自定义项目可调整 include/exclude

## 索引损坏/manifest 缺失

- `synapsedb check <db> --strict` 定位问题；`synapsedb repair <db> --fast` 修复；必要时重建索引（`rebuildIndexes: true`）

## 并发写冲突

- 生产建议 `enableLock: true`；读者不受写锁限制，建议 `registerReader: true`

## 长链路查询中途“结果漂移”

- 使用 `withSnapshot(fn)` 固定 manifest epoch，避免 compact/GC 并发影响
