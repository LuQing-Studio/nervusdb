# æ€§èƒ½åŸºå‡†ä¸æµ‹è¯•

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**  
- [basic.mjs](file://benchmarks/basic.mjs)
- [comprehensive.mjs](file://benchmarks/comprehensive.mjs)
- [insert_scan.mjs](file://benchmarks/insert_scan.mjs)
- [path_agg.mjs](file://benchmarks/path_agg.mjs)
- [framework.mjs](file://benchmarks/framework.mjs)
- [quick.mjs](file://benchmarks/quick.mjs)
- [run-all.mjs](file://benchmarks/run-all.mjs)
- [bench-standard.mjs](file://scripts/bench-standard.mjs)
- [performance_baseline.test.ts](file://tests/performance/performance_baseline.test.ts)
- [performance_large_insert.test.ts](file://tests/performance/performance_large_insert.test.ts)
- [property_index_performance.test.ts](file://tests/performance/property_index_performance.test.ts)
- [synapseDb.ts](file://src/synapseDb.ts)
- [persistentStore.ts](file://src/storage/persistentStore.ts)
- [propertyIndex.ts](file://src/storage/propertyIndex.ts)
- [suites.ts](file://src/benchmark/suites.ts)
- [community.ts](file://src/algorithms/community.ts)
- [snapshot_memory_optimization.test.ts](file://tests/system/snapshot_memory_optimization.test.ts) - *åœ¨æœ€è¿‘æäº¤ä¸­æ›´æ–°*
- [index_manager.test.ts](file://tests/unit/benchmark/index_manager.test.ts) - *æ–°å¢æ€§èƒ½åŸºå‡†æµ‹è¯•ç”¨ä¾‹*
- [manager_benchmark.test.ts](file://tests/unit/benchmark/manager_benchmark.test.ts) - *æ–°å¢æ€§èƒ½åŸºå‡†æµ‹è¯•ç”¨ä¾‹*
- [suites_import.test.ts](file://tests/unit/benchmark/suites_import.test.ts) - *æ–°å¢æ€§èƒ½åŸºå‡†æµ‹è¯•ç”¨ä¾‹*
- [global-cleanup.ts](file://tests/setup/global-cleanup.ts) - *å¼•å…¥å…¨å±€æ¸…ç†æœºåˆ¶*
- [index.ts](file://src/benchmark/index.ts) - *å·²å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨å¤–éƒ¨è„šæœ¬*
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**   
- åœ¨â€œæ ‡å‡†æ€§èƒ½æµ‹è¯•æ‰§è¡Œæ–¹æ³•â€éƒ¨åˆ†æ›´æ–°äº†åŸºå‡†æµ‹è¯•çš„æ‰§è¡Œæ–¹å¼ï¼Œå¼•å…¥äº†æ–°çš„ç»Ÿä¸€å…¥å£è„šæœ¬ `run-all.mjs`ã€‚
- æ–°å¢äº†å¯¹ `global-cleanup.ts` æ–‡ä»¶çš„å¼•ç”¨ï¼Œè¯¥æ–‡ä»¶å®ç°äº†æµ‹è¯•åè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®åº“æ–‡ä»¶çš„æœºåˆ¶ã€‚
- æ›´æ–°äº†â€œåŸºå‡†æµ‹è¯•è„šæœ¬è¯´æ˜â€éƒ¨åˆ†ï¼Œæ˜ç¡®äº† `run-all.mjs` ä½œä¸ºæ¨èçš„ç»Ÿä¸€å…¥å£è„šæœ¬ã€‚
- æ ¹æ® `src/benchmark/index.ts` çš„å˜æ›´ï¼Œæ›´æ–°äº†å…³äº `BenchmarkManager` ç±»çš„è¯´æ˜ï¼Œå¼ºè°ƒå…¶å·²å¼ƒç”¨å¹¶æ¨èä½¿ç”¨å¤–éƒ¨è„šæœ¬ã€‚
- ä¿æŒåŸæœ‰æ–‡æ¡£ç»“æ„å’Œå…¶ä½™å†…å®¹ä¸å˜ã€‚

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [åŸºå‡†æµ‹è¯•è„šæœ¬è¯´æ˜](#åŸºå‡†æµ‹è¯•è„šæœ¬è¯´æ˜)
3. [æ ‡å‡†æ€§èƒ½æµ‹è¯•æ‰§è¡Œæ–¹æ³•](#æ ‡å‡†æ€§èƒ½æµ‹è¯•æ‰§è¡Œæ–¹æ³•)
4. [æŠ¥å‘ŠæŒ‡æ ‡è§£è¯»](#æŠ¥å‘ŠæŒ‡æ ‡è§£è¯»)
5. [å…³é”®è·¯å¾„æ€§èƒ½åˆ†æ](#å…³é”®è·¯å¾„æ€§èƒ½åˆ†æ)
6. [æ€§èƒ½è°ƒä¼˜å»ºè®®](#æ€§èƒ½è°ƒä¼˜å»ºè®®)
7. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
SynapseDB æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½å›¾æ•°æ®åº“ç³»ç»Ÿï¼Œæ”¯æŒå¤§è§„æ¨¡ä¸‰å…ƒç»„å­˜å‚¨ã€å±æ€§ç´¢å¼•ã€å¤æ‚å›¾æŸ¥è¯¢å’Œèšåˆæ“ä½œã€‚ä¸ºç¡®ä¿å…¶åœ¨ä¸åŒç¡¬ä»¶ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§ï¼Œé¡¹ç›®æä¾›äº†å®Œæ•´çš„æ€§èƒ½åŸºå‡†æµ‹è¯•ä½“ç³»ã€‚

æœ¬æ–‡æ¡£æ—¨åœ¨æä¾›ä¸€å¥—å¯å¤ç°çš„æ€§èƒ½æµ‹è¯•æ–¹æ³•è®ºï¼Œå¸®åŠ©å¼€å‘è€…å’Œç”¨æˆ·ç†è§£ç³»ç»Ÿçš„æ€§èƒ½ç‰¹å¾ï¼Œè¯†åˆ«æ½œåœ¨ç“¶é¢ˆï¼Œå¹¶æ ¹æ®å®é™…åº”ç”¨åœºæ™¯è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„æµ‹è¯•æµç¨‹å’Œè¯¦å°½çš„ç»“æœåˆ†æï¼Œç”¨æˆ·å¯ä»¥åœ¨ç›®æ ‡éƒ¨ç½²ç¯å¢ƒä¸­è·å¾—çœŸå®å¯é çš„æ€§èƒ½é¢„æœŸã€‚

## åŸºå‡†æµ‹è¯•è„šæœ¬è¯´æ˜
é¡¹ç›® `benchmarks` ç›®å½•ä¸‹æä¾›äº†å¤šç§ç±»å‹çš„åŸºå‡†æµ‹è¯•è„šæœ¬ï¼Œç”¨äºè¯„ä¼°ä¸åŒå·¥ä½œè´Ÿè½½ä¸‹çš„ç³»ç»Ÿè¡¨ç°ã€‚

### åŸºç¡€å†™å…¥ååé‡æµ‹è¯• (basic.mjs)
è¯¥è„šæœ¬æµ‹é‡æœ€åŸºç¡€çš„ä¸‰å…ƒç»„æ’å…¥æ€§èƒ½å’Œå…¨è¡¨æ‰«ææ•ˆç‡ã€‚å®ƒåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°æ®åº“ï¼Œæ‰¹é‡æ’å…¥ 5000 æ¡ä¸‰å…ƒç»„ï¼ˆå¦‚ `u0 KNOWS v0`ï¼‰ï¼Œç„¶åæ‰§è¡Œä¸€æ¬¡å…¨é‡æ‰«ææŸ¥è¯¢ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹]) --> CreateDB["åˆ›å»ºä¸´æ—¶æ•°æ®åº“"]
CreateDB --> Insert["æ‰¹é‡æ’å…¥ 5000 æ¡ä¸‰å…ƒç»„"]
Insert --> Flush["åˆ·ç›˜æŒä¹…åŒ–"]
Flush --> ScanAll["å…¨é‡æ‰«ææŸ¥è¯¢"]
ScanAll --> CloseDB["å…³é—­å¹¶æ¸…ç†æ•°æ®åº“"]
CloseDB --> End([ç»“æŸ])
```

**æµ‹è¯•é‡ç‚¹**
- å°è§„æ¨¡æ•°æ®çš„å†™å…¥å»¶è¿Ÿ
- å†…å­˜åˆ°ç£ç›˜çš„åŒæ­¥æ•ˆç‡
- å…¨è¡¨æ‰«æçš„ I/O æ€§èƒ½

**ä»£ç è·¯å¾„**
- æ’å…¥é€»è¾‘: `db.addFact()` æ‰¹é‡è°ƒç”¨
- æŒä¹…åŒ–: `await db.flush()`
- æŸ¥è¯¢: `db.find({ predicate: 'KNOWS' }).toArray()`

**ç›¸å…³æ–‡ä»¶**
- [basic.mjs](file://benchmarks/basic.mjs)

### ç»¼åˆæ··åˆè´Ÿè½½æµ‹è¯• (comprehensive.mjs)
è¿™æ˜¯æœ€å…¨é¢çš„æ€§èƒ½å¥—ä»¶ï¼Œæ¨¡æ‹Ÿäº†ç°å®ä¸–ç•Œä¸­å…¸å‹çš„æ··åˆè¯»å†™åœºæ™¯ã€‚å®ƒä½¿ç”¨è‡ªå®šä¹‰çš„ `BenchmarkSuite` æ¡†æ¶ï¼ŒåŒ…å«å¤šä¸ªå­å¥—ä»¶ï¼š

1.  **æ•°æ®æ’å…¥æ€§èƒ½æµ‹è¯•**: æµ‹è¯•å°ã€ä¸­ã€å¤§è§„æ¨¡æ•°æ®é›†çš„æ’å…¥é€Ÿåº¦åŠå†…å­˜å ç”¨ã€‚
2.  **æŸ¥è¯¢æ€§èƒ½æµ‹è¯•**: è¦†ç›–ç²¾ç¡®æŸ¥è¯¢ã€æ¨¡å¼åŒ¹é…ã€æµå¼å¤„ç†å’Œé“¾å¼è”æƒ³ç­‰ã€‚
3.  **å›¾ç®—æ³•æ€§èƒ½æµ‹è¯•**: è¯„ä¼°æœ€çŸ­è·¯å¾„ï¼ˆBFSã€åŒå‘BFSã€Dijkstraï¼‰ç­‰æ ¸å¿ƒå›¾ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡ã€‚
4.  **èšåˆæ€§èƒ½æµ‹è¯•**: æµ‹è¯• COUNTã€AVGã€SUM ç­‰èšåˆå‡½æ•°ä»¥åŠæµå¼èšåˆçš„æ€§èƒ½ã€‚

```mermaid
graph TB
subgraph "ç»¼åˆåŸºå‡†å¥—ä»¶"
A[æ’å…¥æ€§èƒ½]
B[æŸ¥è¯¢æ€§èƒ½]
C[å›¾ç®—æ³•]
D[èšåˆæ€§èƒ½]
end
A --> |ç”Ÿæˆæ•°æ®| E[(æµ‹è¯•æ•°æ®åº“)]
B --> |è¯»å–æ•°æ®| E
C --> |è¯»å–æ•°æ®| E
D --> |è¯»å–æ•°æ®| E
E --> F[ç”ŸæˆJSONæŠ¥å‘Š]
```

**ç‰¹ç‚¹**
- æ”¯æŒ GC æŒ‡æ ‡æ”¶é›†ï¼ˆéœ€ `--expose-gc`ï¼‰
- åŒ…å«é¢„çƒ­è¿è¡Œå’Œå¤šæ¬¡æµ‹é‡ä»¥æé«˜å‡†ç¡®æ€§
- è¾“å‡ºè¯¦ç»†çš„ JSON æ ¼å¼æŠ¥å‘Šï¼Œä¾¿äºè‡ªåŠ¨åŒ–åˆ†æ

**ç›¸å…³æ–‡ä»¶**
- [comprehensive.mjs](file://benchmarks/comprehensive.mjs)
- [framework.mjs](file://benchmarks/framework.mjs)

### æ‰«ææ€§èƒ½è¯„ä¼° (insert_scan.mjs)
æ­¤è„šæœ¬ä¸“æ³¨äºè¯„ä¼°å¤§è§„æ¨¡æ’å…¥åçš„æŸ¥è¯¢æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯æ‰«ææ“ä½œçš„æ•ˆç‡ã€‚å®ƒå…è®¸é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šæ•°æ®è§„æ¨¡ï¼ˆé»˜è®¤ 20,000 æ¡ï¼‰ã€‚

**æµ‹è¯•æµç¨‹**
1.  **æ’å…¥**: å¿«é€Ÿæ’å…¥ N æ¡ä¸‰å…ƒç»„ï¼ˆä¸»è¯­å¾ªç¯ä½¿ç”¨ 1000 ä¸ª IDï¼‰ã€‚
2.  **åˆ·ç›˜**: æ˜¾å¼è°ƒç”¨ `flush()` å°†æ•°æ®æŒä¹…åŒ–ã€‚
3.  **å…¨æ‰«æ**: æ‰§è¡Œ `find({ predicate: 'KNOWS' })` è·å–æ‰€æœ‰åŒ¹é…è®°å½•ã€‚
4.  **è¿‡æ»¤æ‰«æ**: æ‰§è¡Œ `find({ subject: 'user1', predicate: 'KNOWS' })` è¿›è¡Œå¸¦æ¡ä»¶çš„æ‰«æã€‚

è¯¥è„šæœ¬æ¸…æ™°åœ°åˆ†ç¦»äº†å†™å…¥ã€æŒä¹…åŒ–å’Œè¯»å–é˜¶æ®µï¼Œæœ‰åŠ©äºåˆ†ææ¯ä¸ªç¯èŠ‚çš„è€—æ—¶ã€‚

**ç›¸å…³æ–‡ä»¶**
- [insert_scan.mjs](file://benchmarks/insert_scan.mjs)

### å…¶ä»–ä¸“ç”¨æµ‹è¯•è„šæœ¬
- **path_agg.mjs**: ä¸“é—¨æµ‹è¯•å˜é•¿è·¯å¾„æŸ¥è¯¢å’Œèšåˆç®¡é“çš„æ€§èƒ½ã€‚
- **quick.mjs**: å¿«é€ŸéªŒè¯è„šæœ¬ï¼Œç”¨äºå¼€å‘è¿‡ç¨‹ä¸­çš„å³æ—¶æ€§èƒ½æ£€æŸ¥ã€‚
- **run-all.mjs**: **ç»Ÿä¸€çš„åŸºå‡†æµ‹è¯•å…¥å£è„šæœ¬**ï¼Œæ¨èä½¿ç”¨ã€‚å®ƒæ¥å— `--suite` å‚æ•°æ¥è¿è¡Œç‰¹å®šå¥—ä»¶ï¼Œå¹¶æ”¯æŒ `--format` å’Œ `--output` å‚æ•°æ¥ç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Šã€‚

**ç›¸å…³æ–‡ä»¶**
- [run-all.mjs](file://benchmarks/run-all.mjs)

## æ ‡å‡†æ€§èƒ½æµ‹è¯•æ‰§è¡Œæ–¹æ³•
æ¨èä½¿ç”¨ `benchmarks/run-all.mjs` è„šæœ¬ä½œä¸ºæ ‡å‡†æ€§èƒ½æµ‹è¯•çš„å…¥å£ï¼Œå› ä¸ºå®ƒæä¾›äº†ç»Ÿä¸€çš„æ¥å£å¹¶æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ã€‚

### æ‰§è¡Œæ­¥éª¤
1.  **å‡†å¤‡ç¯å¢ƒ**: ç¡®ä¿ Node.js ç¯å¢ƒå·²å®‰è£…ï¼Œå¹¶å…‹éš† SynapseDB ä»“åº“ã€‚
2.  **ç¼–è¯‘é¡¹ç›®**: è¿è¡Œ `npm run build` æˆ– `pnpm build` ä»¥ç”Ÿæˆ `dist` ç›®å½•ä¸‹çš„ç¼–è¯‘æ–‡ä»¶ã€‚
3.  **è¿è¡Œè„šæœ¬**: åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
    ```bash
    node benchmarks/run-all.mjs --suite=all --format=console,json --output=./benchmark-reports
    ```
    - `--suite`: æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•å¥—ä»¶ï¼Œå¯é€‰å€¼åŒ…æ‹¬ `all`, `core`, `search`, `graph`, `spatial`, `quick`, `insert`, `path`ã€‚
    - `--format`: æŒ‡å®šæŠ¥å‘Šè¾“å‡ºæ ¼å¼ï¼Œå¯ä½¿ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ¼å¼ï¼Œå¦‚ `console,json,html,csv`ã€‚
    - `--output`: æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚

### ç¤ºä¾‹è¾“å‡º
```text
ğŸš€ å¯åŠ¨ SynapseDB åŸºå‡†æµ‹è¯•...
   å¥—ä»¶: all
   è¾“å‡ºæ ¼å¼: console,json
   è¾“å‡ºç›®å½•: ./benchmark-reports

ğŸ“ è¿è¡Œè„šæœ¬: comprehensive.mjs

... (comprehensive.mjs çš„è¯¦ç»†è¾“å‡º) ...

ğŸ“„ å·²ç”Ÿæˆ JSON æŠ¥å‘Š: ./benchmark-reports/benchmark-report-2024-07-15T10-30-00.json
ğŸ“Š åŸºå‡†æµ‹è¯•å®Œæˆæ‘˜è¦:
æ€»æµ‹è¯•æ•°: (å‚è§è¾“å‡º)
è¾“å‡ºç›®å½•: ./benchmark-reports
```

**ç›¸å…³æ–‡ä»¶**
- [run-all.mjs](file://benchmarks/run-all.mjs)
- [bench-standard.mjs](file://scripts/bench-standard.mjs)

## æŠ¥å‘ŠæŒ‡æ ‡è§£è¯»
æ€§èƒ½æµ‹è¯•æŠ¥å‘Šä¸­çš„å…³é”®æŒ‡æ ‡å¯¹äºè¯„ä¼°ç³»ç»Ÿå¥åº·çŠ¶å†µè‡³å…³é‡è¦ã€‚

### QPS (Queries Per Second)
QPS è¡¡é‡ç³»ç»Ÿæ¯ç§’èƒ½å¤Ÿå¤„ç†çš„æŸ¥è¯¢è¯·æ±‚æ•°ã€‚åœ¨ `bench-standard.mjs` ä¸­ï¼Œå¯ä»¥é€šè¿‡æ€»æŸ¥è¯¢æ—¶é—´ä¼°ç®—ï¼š
```
QPS = --limit çš„å€¼ / æŸ¥è¯¢è€—æ—¶(ç§’)
```
ä¾‹å¦‚ï¼Œå¦‚æœ `pattern.query` è€—æ—¶ 89ms è¿”å› 1000 æ¡ï¼Œåˆ™ QPS â‰ˆ 1000 / 0.089 â‰ˆ 11,236ã€‚

### å»¶è¿Ÿåˆ†å¸ƒ
å»¶è¿Ÿæ˜¯æŒ‡ä»å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚`comprehensive.mjs` ä¼šè®°å½•æ¯æ¬¡æµ‹é‡çš„è€—æ—¶ã€‚å…³æ³¨ç‚¹åŒ…æ‹¬ï¼š
- **å¹³å‡å»¶è¿Ÿ**: æ‰€æœ‰è¿è¡Œæ—¶é—´çš„ç®—æœ¯å¹³å‡å€¼ã€‚
- **P95/P99 å»¶è¿Ÿ**: 95% æˆ– 99% è¯·æ±‚å®Œæˆæ‰€éœ€çš„æœ€å¤§æ—¶é—´ï¼Œæ˜¯è¡¡é‡ç³»ç»Ÿå°¾éƒ¨å»¶è¿Ÿçš„å…³é”®æŒ‡æ ‡ã€‚

### å¤šæ ¼å¼æŠ¥å‘Šç”Ÿæˆ
`run-all.mjs` è„šæœ¬æ”¯æŒç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Šï¼Œä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ï¼š
- **æ§åˆ¶å°æŠ¥å‘Š**: å®æ—¶è¾“å‡ºç®€æ´çš„æ–‡æœ¬æ‘˜è¦ã€‚
- **HTMLæŠ¥å‘Š**: ç”Ÿæˆäº¤äº’å¼ç½‘é¡µæŠ¥å‘Šï¼ŒåŒ…å«å›¾è¡¨å’Œè¯¦ç»†æ•°æ®ã€‚
- **JSONæŠ¥å‘Š**: ç”Ÿæˆæœºå™¨å¯è¯»çš„ç»“æ„åŒ–æ•°æ®ï¼Œä¾¿äºé›†æˆåˆ°CI/CDæµæ°´çº¿ã€‚
- **CSVæŠ¥å‘Š**: ç”Ÿæˆè¡¨æ ¼æ•°æ®ï¼Œæ–¹ä¾¿å¯¼å…¥ç”µå­è¡¨æ ¼è½¯ä»¶è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚

**ç›¸å…³æ–‡ä»¶**
- [run-all.mjs](file://benchmarks/run-all.mjs)

### æ€§èƒ½å›å½’æ£€æµ‹
ç³»ç»Ÿå†…ç½®äº†æ€§èƒ½å›å½’æ£€æµ‹åŠŸèƒ½ï¼Œå¯é€šè¿‡ `runRegressionTest` æ–¹æ³•æ¯”è¾ƒå½“å‰æµ‹è¯•ç»“æœä¸åŸºçº¿æŠ¥å‘Šã€‚å®ƒä¼šè®¡ç®—å…³é”®æŒ‡æ ‡ï¼ˆå¦‚æ‰§è¡Œæ—¶é—´ã€å†…å­˜ä½¿ç”¨ã€æ¯ç§’æ“ä½œæ•°ï¼‰çš„å˜åŒ–ç™¾åˆ†æ¯”ï¼Œå¹¶