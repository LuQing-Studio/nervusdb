# 快速入门

<cite>
**本文档中引用的文件**
- [synapseDb.ts](file://src/synapseDb.ts)
- [queryBuilder.ts](file://src/query/queryBuilder.ts)
- [openOptions.ts](file://src/types/openOptions.ts)
- [cypher.ts](file://src/query/cypher.ts)
- [pattern/match.ts](file://src/query/pattern/match.ts)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备与安装](#环境准备与安装)
3. [核心操作流程](#核心操作流程)
4. [构建人物关系知识图谱案例](#构建人物关系知识图谱案例)
5. [异步API与错误处理](#异步api与错误处理)
6. [高级查询功能](#高级查询功能)
7. [关闭数据库连接](#关闭数据库连接)

## 简介
SynapseDB 是一个嵌入式三元组知识库，专为存储和查询 SPO（主语-谓语-宾语）数据而设计。本指南将帮助您在5分钟内完成初始化并执行首个查询操作。

## 环境准备与安装
在开始使用 SynapseDB 之前，请确保您的开发环境满足以下要求：

- **Node.js 版本**: 18 或更高版本
- **包管理工具**: 推荐使用 pnpm

通过以下命令安装 SynapseDB：
```bash
pnpm add synapsedb
```

安装完成后，即可在项目中导入并使用 SynapseDB。

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L96-L99)

## 核心操作流程
### 打开数据库连接
使用 `SynapseDB.open()` 方法打开或创建数据库实例。该方法接受数据库文件路径作为参数，并返回一个 Promise，解析为数据库实例。

```typescript
const db = await SynapseDB.open('./my-database.synapsedb');
```

您还可以提供配置选项来定制数据库行为，例如页面大小、压缩设置等。

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L96-L99)
- [openOptions.ts](file://src/types/openOptions.ts#L10-L152)

### 插入SPO三元组
使用 `addFact` 方法向数据库中添加事实记录。每个事实由主语、谓语和宾语组成，并可附带节点或边的属性。

```typescript
db.addFact({ subject: 'Alice', predicate: 'knows', object: 'Bob' });
```

此外，可以通过 `options` 参数为节点或边设置额外属性。

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L101-L131)

### 执行链式查询
利用 `find().follow()` 实现链式查询，支持基于条件筛选后进行关联扩展。

```typescript
const results = db.find({ predicate: 'knows' }).follow('worksAt').all();
```

此功能允许您轻松遍历知识图谱中的关系网络。

**Section sources**
- [queryBuilder.ts](file://src/query/queryBuilder.ts#L643-L645)
- [synapseDb.ts](file://src/synapseDb.ts#L234-L282)

## 构建人物关系知识图谱案例
下面展示如何构建一个简单的人物-关系网络，演示基本的增删查功能。

### 初始化数据
首先插入一些基础的事实记录：

```typescript
db.addFact({ subject: 'Alice', predicate: 'knows', object: 'Bob' });
db.addFact({ subject: 'Bob', predicate: 'knows', object: 'Charlie' });
db.addFact({ subject: 'Alice', predicate: 'worksAt', object: 'TechCorp' });
await db.flush(); // 确保数据持久化
```

### 查询数据
执行多种类型的查询以检索信息：

```typescript
// 查找所有知道 Bob 的人
const knowBob = db.find({ object: 'Bob', predicate: 'knows' }).all();

// 链式查询：找到 Alice 认识的人及其工作单位
const aliceNetwork = db.find({ subject: 'Alice', predicate: 'knows' })
                       .follow('worksAt')
                       .all();
```

### 删除数据
从数据库中移除指定的事实记录：

```typescript
db.deleteFact({ subject: 'Alice', predicate: 'knows', object: 'Bob' });
```

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L101-L131)
- [queryBuilder.ts](file://src/query/queryBuilder.ts#L643-L645)

## 异步API与错误处理
SynapseDB 的大多数操作都是异步的，因此需要使用 `async/await` 或 Promise 进行调用。建议使用 try-catch 结构捕获潜在错误。

```typescript
try {
  const db = await SynapseDB.open('./my-db.synapsedb');
  // 执行数据库操作
} catch (error) {
  console.error('数据库操作失败:', error);
} finally {
  await db.close();
}
```

这能有效防止因文件访问问题或锁定冲突导致的应用崩溃。

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L96-L99)
- [synapseDb.ts](file://src/synapseDb.ts#L472-L474)

## 高级查询功能
### 流式查询
对于大数据集，推荐使用 `findStreaming` 方法以避免内存压力。

```typescript
for await (const fact of db.findStreaming({ predicate: 'HAS_METHOD' })) {
  console.log(fact);
}
```

### 基于属性的查询
根据节点或边的属性进行过滤查询：

```typescript
db.findByNodeProperty({ propertyName: 'age', value: 25 }).all();
db.findByEdgeProperty({ propertyName: 'weight', value: 0.8 }).all();
```

### 模式匹配
使用模式匹配语法查找复杂结构：

```typescript
const patternResults = await db.match()
  .node('a', ['Person'], { name: 'Alice' })
  .edge('->', 'knows')
  .node('b', ['Person'])
  .return(['a.name', 'b.name'])
  .execute();
```

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L216-L232)
- [queryBuilder.ts](file://src/query/queryBuilder.ts#L643-L645)
- [pattern/match.ts](file://src/query/pattern/match.ts#L0-L235)

## 关闭数据库连接
完成所有操作后，务必调用 `close()` 方法释放资源。

```typescript
await db.close();
```

此步骤确保所有未写入的数据被刷新到磁盘，并正确关闭文件句柄。

**Section sources**
- [synapseDb.ts](file://src/synapseDb.ts#L472-L474)